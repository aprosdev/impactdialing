/*!
 * Pusher JavaScript Library v2.0.0-pre
 * http://pusherapp.com/
 *
 * Copyright 2011, Pusher
 * Released under the MIT licence.
 */

(function(){function c(a,b){var d=this;this.options=b||{};this.key=a;this.channels=new c.Channels;this.global_emitter=new c.EventsDispatcher;this.sessionID=Math.floor(Math.random()*1E9);this.checkAppKey();this.connection=new c.ConnectionManager(this.key,c.Util.extend({getStrategy:function(b){return c.StrategyBuilder.build(c.Util.extend(c.defaultStrategy,d.options,b))},getTimeline:function(b,a){var f=new c.JSONPSender({url:"http"+(b.encrypted?"s":"")+"://"+c.stats_host+"/timeline",receiver:c.JSONP}),
g=new c.Timeline(d.sessionID,f,{key:d.key,features:c.Util.keys(c.Util.filterObject({ws:c.WSTransport,flash:c.FlashTransport},function(b){return b.isSupported()})),params:d.options.timelineParams||{},limit:25}),f=function(){g.isEmpty()||g.send(function(){})};a.bind("connected",f);setInterval(f,6E4);return g},activityTimeout:c.activity_timeout,pongTimeout:c.pong_timeout,unavailableTimeout:c.unavailable_timeout},this.options));this.connection.bind("connected",function(){d.subscribeAll()}).bind("message",
function(b){var a=b.event.indexOf("pusher_internal:")===0;if(b.channel){var c=d.channel(b.channel);c&&c.emit(b.event,b.data)}a||d.global_emitter.emit(b.event,b.data)}).bind("disconnected",function(){d.channels.disconnect()}).bind("error",function(b){c.warn("Error",b)});c.instances.push(this);c.isReady&&d.connect()}c.instances=[];c.isReady=!1;c.debug=function(){c.log&&c.log(c.Util.stringify.apply(this,arguments))};c.warn=function(){window.console&&window.console.warn?window.console.warn(c.Util.stringify.apply(this,
arguments)):c.log&&c.log(c.Util.stringify.apply(this,arguments))};c.ready=function(){c.isReady=!0;for(var a=0,b=c.instances.length;a<b;a++)c.instances[a].connect()};c.prototype={channel:function(a){return this.channels.find(a)},connect:function(){this.connection.connect()},disconnect:function(){this.connection.disconnect()},bind:function(a,b){this.global_emitter.bind(a,b);return this},bind_all:function(a){this.global_emitter.bind_all(a);return this},subscribeAll:function(){for(var a in this.channels.channels)this.channels.channels.hasOwnProperty(a)&&
this.subscribe(a)},subscribe:function(a){var b=this,d=this.channels.add(a,this);this.connection.state==="connected"&&d.authorize(this.connection.socket_id,this.options,function(c,e){c?d.emit("pusher:subscription_error",e):b.send_event("pusher:subscribe",{channel:a,auth:e.auth,channel_data:e.channel_data})});return d},unsubscribe:function(a){this.channels.remove(a);this.connection.state==="connected"&&this.send_event("pusher:unsubscribe",{channel:a})},send_event:function(a,b,d){return this.connection.send_event(a,
b,d)},checkAppKey:function(){(this.key===null||this.key===void 0)&&c.warn("Warning","You must pass your app key when you instantiate Pusher.")}};this.Pusher=c}).call(this);
(function(){Pusher.Util={now:function(){return Date.now?Date.now():(new Date).valueOf()},extend:function(c){for(var a=1;a<arguments.length;a++){var b=arguments[a],d;for(d in b)c[d]=b[d]&&b[d].constructor&&b[d].constructor===Object?Pusher.Util.extend(c[d]||{},b[d]):b[d]}return c},stringify:function(){for(var c=["Pusher"],a=0;a<arguments.length;a++)typeof arguments[a]==="string"?c.push(arguments[a]):window.JSON===void 0?c.push(arguments[a].toString()):c.push(JSON.stringify(arguments[a]));return c.join(" : ")},
arrayIndexOf:function(c,a){var b=Array.prototype.indexOf;if(c===null)return-1;if(b&&c.indexOf===b)return c.indexOf(a);for(i=0,l=c.length;i<l;i++)if(c[i]===a)return i;return-1},keys:function(c){var a=[],b;for(b in c)Object.prototype.hasOwnProperty.call(c,b)&&a.push(b);return a},apply:function(c,a){for(var b=0;b<c.length;b++)a(c[b],b,c)},objectApply:function(c,a){for(var b in c)Object.prototype.hasOwnProperty.call(c,b)&&a(c[b],b,c)},map:function(c,a){for(var b=[],d=0;d<c.length;d++)b.push(a(c[d],d,
c,b));return b},mapObject:function(c,a){var b={},d;for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&(b[d]=a(c[d]));return b},filter:function(c,a){for(var a=a||function(b){return!!b},b=[],d=0;d<c.length;d++)a(c[d],d,c,b)&&b.push(c[d]);return b},filterObject:function(c,a){var a=a||function(b){return!!b},b={},d;for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&a(c[d],d,c,b)&&(b[d]=c[d]);return b},flatten:function(c){var a=[],b;for(b in c)Object.prototype.hasOwnProperty.call(c,b)&&a.push([b,
c[b]]);return a},all:function(c,a){for(var b=0;b<c.length;b++)if(!a(c[b],b,c))return!1;return!0},method:function(c){var a=Array.prototype.slice.call(arguments,1);return function(b){return b[c].apply(b,a.concat(arguments))}}}}).call(this);
(function(){Pusher.VERSION="2.0.0-pre";Pusher.host="ws.pusherapp.com";Pusher.ws_port=80;Pusher.wss_port=443;Pusher.sockjs_host="sockjs.pusher.com";Pusher.sockjs_http_port=80;Pusher.sockjs_https_port=443;Pusher.sockjs_path="/pusher";Pusher.stats_host="pusher-timeline.herokuapp.com";Pusher.channel_auth_endpoint="/pusher/auth";Pusher.cdn_http="http://js.pusher.com";Pusher.cdn_https="https://d3dy5gmtp8yhk7.cloudfront.net";Pusher.dependency_suffix=".min";Pusher.channel_auth_transport="ajax";Pusher.activity_timeout=
12E4;Pusher.pong_timeout=3E4;Pusher.unavailable_timeout=1E4;Pusher.defaultStrategy={type:"first_supported",host:"ws.pusherapp.com",unencryptedPort:80,encryptedPort:443,loop:!0,timeoutLimit:8E3,children:[{type:"sequential",timeout:2E3,children:[{type:"transport",transport:"ws"},{type:"transport",transport:"ws",encrypted:!0}]},{type:"sequential",timeout:5E3,children:[{type:"transport",transport:"flash"},{type:"transport",transport:"flash",encrypted:!0}]},{type:"sequential",timeout:2E3,host:"sockjs.pusher.com",
children:[{type:"transport",transport:"sockjs"},{type:"transport",transport:"sockjs",encrypted:!0}]}]}}).call(this);(function(){function c(a){var b=function(b){Error.call(this,b);this.name=a};Pusher.Util.extend(b.prototype,Error.prototype);return b}Pusher.Errors={UnsupportedTransport:c("UnsupportedTransport"),UnsupportedStrategy:c("UnsupportedStrategy"),TransportClosed:c("TransportClosed")}}).call(this);
(function(){function c(){this._callbacks={}}function a(b){this.callbacks=new c;this.global_callbacks=[];this.failThrough=b}c.prototype.get=function(b){return this._callbacks[this._prefix(b)]};c.prototype.add=function(b,a){var c=this._prefix(b);this._callbacks[c]=this._callbacks[c]||[];this._callbacks[c].push(a)};c.prototype.remove=function(b,a){if(this.get(b)){var c=Pusher.Util.arrayIndexOf(this.get(b),a);this._callbacks[this._prefix(b)].splice(c,1)}};c.prototype._prefix=function(b){return"_"+b};
a.prototype.bind=function(b,a){this.callbacks.add(b,a);return this};a.prototype.unbind=function(b,a){this.callbacks.remove(b,a);return this};a.prototype.emit=function(b,a){for(var c=0;c<this.global_callbacks.length;c++)this.global_callbacks[c](b,a);var e=this.callbacks.get(b);if(e)for(c=0;c<e.length;c++)e[c](a);else this.failThrough&&this.failThrough(b,a);return this};a.prototype.bind_all=function(b){this.global_callbacks.push(b);return this};this.Pusher.EventsDispatcher=a}).call(this);
(function(){function c(b){this.options=b;this.loading={};this.loaded={}}function a(b,a){document.addEventListener?b.addEventListener("load",a,!1):b.attachEvent("onreadystatechange",function(){(b.readyState=="loaded"||b.readyState=="complete")&&a()})}function b(b,d){var c=document.getElementsByTagName("head")[0],g=document.createElement("script");g.setAttribute("src",b);g.setAttribute("type","text/javascript");g.setAttribute("async",!0);a(g,function(){setTimeout(d,0)});c.appendChild(g)}var d=c.prototype;
d.load=function(a,d){var c=this;if(this.loaded[a])d();else if(this.loading[a]||(this.loading[a]=[]),this.loading[a].push(d),!(this.loading[a].length>1)){var g=this.getRoot()+"/"+a+this.options.suffix+".js";b([g],function(){for(var b=0;b<c.loading[a].length;b++)c.loading[a][b]();delete c.loading[a];c.loaded[a]=!0})}};d.getRoot=function(){return(document.location.protocol==="http:"?this.options.cdn_http:this.options.cdn_https)+"/"+this.options.version};Pusher.DependencyLoader=c}).call(this);
(function(){function c(){Pusher.ready()}function a(b){document.body?b():setTimeout(function(){a(b)},0)}function b(){a(c)}Pusher.Dependencies=new Pusher.DependencyLoader({cdn_http:Pusher.cdn_http,cdn_https:Pusher.cdn_https,version:Pusher.VERSION,suffix:Pusher.dependency_suffix});if(!window.WebSocket&&window.MozWebSocket)window.WebSocket=window.MozWebSocket;window.JSON?b():Pusher.Dependencies.load("json2",b)})();
(function(){for(var c=String.fromCharCode,a=0;a<64;a++)"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a);var b=function(b){var a=b.charCodeAt(0);return a<128?b:a<2048?c(192|a>>>6)+c(128|a&63):c(224|a>>>12&15)+c(128|a>>>6&63)+c(128|a&63)},d=function(b){var a=[0,2,1][b.length%3],b=b.charCodeAt(0)<<16|(b.length>1?b.charCodeAt(1):0)<<8|(b.length>2?b.charCodeAt(2):0);return["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(b>>>18),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(b>>>
12&63),a>=2?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(b>>>6&63),a>=1?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(b&63)].join("")},h=window.btoa||function(b){return b.replace(/[\s\S]{1,3}/g,d)};Pusher.Base64={encode:function(a){return h(a.replace(/[^\x00-\x7F]/g,b))}}}).call(this);
(function(){function c(b){this.options=b}function a(b){return Pusher.Util.mapObject(b,function(b){typeof b==="object"&&(b=JSON.stringify(b));return encodeURIComponent(Pusher.Base64.encode(b.toString()))})}var b=c.prototype;b.send=function(b,c,e){if(this.script)return!1;var f=this.options.tagPrefix||"_pusher_jsonp_",c=Pusher.Util.extend({},c,{receiver:this.options.receiver}),c=Pusher.Util.map(Pusher.Util.flatten(a(Pusher.Util.filterObject(c,function(b){return b!==void 0}))),Pusher.Util.method("join",
"=")).join("&");this.script=document.createElement("script");this.script.id=f+b;this.script.src=this.options.url+"/"+b+"?"+c;this.script.type="text/javascript";this.script.charset="UTF-8";this.script.onerror=this.script.onload=e;if(this.script.async===void 0&&document.attachEvent&&/opera/i.test(navigator.userAgent))f=this.options.receiver||"Pusher.JSONP.receive",this.errorScript=document.createElement("script"),this.errorScript.text=f+"("+b+", true);",this.script.async=this.errorScript.async=!1;var g=
this;this.script.onreadystatechange=function(){g.script&&/loaded|complete/.test(g.script.readyState)&&e(!0)};b=document.getElementsByTagName("head")[0];b.insertBefore(this.script,b.firstChild);this.errorScript&&b.insertBefore(this.errorScript,this.script.nextSibling);return!0};b.cleanup=function(){if(this.script&&this.script.parentNode)this.script.parentNode.removeChild(this.script),this.script=null;if(this.errorScript&&this.errorScript.parentNode)this.errorScript.parentNode.removeChild(this.errorScript),
this.errorScript=null};Pusher.JSONPRequest=c}).call(this);(function(){function c(){this.lastId=0;this.callbacks={}}var a=c.prototype;a.register=function(b){this.lastId++;var a=this.lastId;this.callbacks[a]=b;return a};a.unregister=function(b){if(this.callbacks[b]){var a=this.callbacks[b];delete this.callbacks[b];return a}else return null};a.receive=function(b,a,c){(b=this.unregister(b))&&b(a,c)};Pusher.JSONPReceiver=c;Pusher.JSONP=new c}).call(this);
(function(){function c(a){this.receiver=a.receiver;this.options=a}c.prototype.send=function(a,b){var c=new Pusher.JSONPRequest({url:this.options.url,receiver:this.options.receiverName,tagPrefix:this.options.tagPrefix}),h=this.receiver.register(function(a,e){c.cleanup();b(a,e)}),e=this;c.send(h,a,function(b){var a=e.receiver.unregister(h);a&&a(b)})};Pusher.JSONPSender=c}).call(this);
(function(){function c(b,a,c){this.session=b;this.jsonp=a;this.events=[];this.options=c||{};this.sent=0}var a=c.prototype;a.push=function(b){this.events.push(Pusher.Util.extend({},b,{timestamp:Pusher.Util.now()}));this.options.limit&&this.events.length>this.options.limit&&this.events.shift()};a.isEmpty=function(){return this.events.length===0};a.send=function(b){if(!this.jsonp)return!1;var a=this,c={};this.sent===0&&(c=Pusher.Util.extend({key:this.options.key,features:this.options.features,version:this.options.version},
this.options.params||{}));c.session=this.session;c.timeline=this.events;Pusher.Util.filterObject(c,function(b){return b!==void 0});this.events=[];this.jsonp.send(c,function(c,h){c||a.sent++;b(c,h)});return!0};Pusher.Timeline=c}).call(this);
(function(){function c(b,a){this.strategies=Pusher.MultiStrategy.filterUnsupported(b);this.options=a||{}}var a=c.prototype;c.filterUnsupported=function(b){return Pusher.Util.filter(b,Pusher.Util.method("isSupported"))};a.isSupported=function(){return this.strategies.length>0};a.getOptions=function(){return this.options};Pusher.MultiStrategy=c}).call(this);
(function(){Pusher.ParallelStrategy={connect:function(c,a){var b=Pusher.Util.map(c,function(b,c,e,f){return b.connect(a(c,f))});return{abort:function(){Pusher.ParallelStrategy.abortRunners(b)}}},allRunnersFailed:function(c){return Pusher.Util.all(c,function(a){return!!a.error})},abortRunner:function(c){if(!c.error&&!c.aborted)c.abort(),c.aborted=!0},abortRunners:function(c){Pusher.Util.apply(c,Pusher.ParallelStrategy.abortRunner)}}}).call(this);
(function(){function c(b,a){Pusher.MultiStrategy.call(this,[b],{delay:a.delay})}var a=c.prototype;Pusher.Util.extend(a,Pusher.MultiStrategy.prototype);a.name="delayed";a.connect=function(b){if(!this.isSupported())return null;var a=this,c=function(){clearTimeout(e);e=null},e=setTimeout(function(){if(e!==null)e=null,c=a.strategies[0].connect(b).abort},this.options.delay);return{abort:function(){c()}}};Pusher.DelayedStrategy=c}).call(this);
(function(){function c(b){Pusher.MultiStrategy.call(this,b)}var a=c.prototype;Pusher.Util.extend(a,Pusher.MultiStrategy.prototype);a.name="first_connected";a.connect=function(b){return!this.isSupported()?null:Pusher.ParallelStrategy.connect(this.strategies,function(a,c){return function(e,f){(c[a].error=e)?Pusher.ParallelStrategy.allRunnersFailed(c)&&b(!0):(Pusher.ParallelStrategy.abortRunners(c),b(null,f))}})};Pusher.FirstConnectedStrategy=c}).call(this);
(function(){function c(b){Pusher.MultiStrategy.call(this,b)}var a=c.prototype;Pusher.Util.extend(a,Pusher.MultiStrategy.prototype);a.name="best_connected_ever";a.connect=function(b){return!this.isSupported()?null:Pusher.ParallelStrategy.connect(this.strategies,function(a,c){return function(e,f){if(c[a].error=e)Pusher.ParallelStrategy.allRunnersFailed(c)&&b(!0);else{for(var g=a+1;g<c.length;g++)Pusher.ParallelStrategy.abortRunner(c[g]);b(null,f)}}})};Pusher.BestConnectedEverStrategy=c}).call(this);
(function(){function c(b){Pusher.FirstConnectedStrategy.call(this,Pusher.MultiStrategy.filterUnsupported(b).slice(0,1))}var a=c.prototype;Pusher.Util.extend(a,Pusher.FirstConnectedStrategy.prototype);a.name="first_supported";Pusher.FirstSupportedStrategy=c}).call(this);
(function(){function c(b,a){Pusher.MultiStrategy.call(this,b,{loop:a.loop,timeout:a.timeout,timeoutLimit:a.timeoutLimit})}var a=c.prototype;Pusher.Util.extend(a,Pusher.MultiStrategy.prototype);a.name="seq";a.connect=function(b){var a=this,c=0,e=this.options.timeout,f=null,g=function(j,k){k?b(null,k):(c+=1,a.options.loop&&(c%=a.strategies.length),c<a.strategies.length?(e&&(e*=2,a.options.timeoutLimit&&(e=Math.min(e,a.options.timeoutLimit))),f=a.tryStrategy(a.strategies[c],e,g)):b(!0))},f=this.tryStrategy(this.strategies[c],
e,g);return{abort:function(){f.abort()}}};a.tryStrategy=function(b,a,c){var e=null,f=null,f=b.connect(function(b,a){if(!b||!e)e&&clearTimeout(e),c(b,a)});a>0&&(e=setTimeout(function(){f.abort();c(!0)},a));return f};Pusher.SequentialStrategy=c}).call(this);
(function(){function c(b,a){this.transport=b;this.options=a}var a=c.prototype;a.name="transport";a.isSupported=function(){return this.transport.isSupported()};a.getOptions=function(){return this.options};a.connect=function(b){var a=this.transport.createConnection(this.options.key,this.options),c=function(){a.unbind("initialized",c);a.connect()},e=function(){j();b(null,a)},f=function(a){j();b(a)},g=function(){j();b(new Pusher.Errors.TransportClosed(this.transport))},j=function(){a.unbind("initialized",
c);a.unbind("open",e);a.unbind("error",f);a.unbind("closed",g)};a.bind("initialized",c);a.bind("open",e);a.bind("error",f);a.bind("closed",g);a.initialize();return{abort:function(){a.state!=="open"&&(j(),a.close())}}};Pusher.TransportStrategy=c}).call(this);
(function(){function c(b,a){Pusher.EventsDispatcher.call(this);this.key=b;this.options=a;this.state="new";this.timeline=a.timeline}var a=c.prototype;Pusher.Util.extend(a,Pusher.EventsDispatcher.prototype);c.isSupported=function(){return!1};a.supportsPing=function(){return!1};a.initialize=function(){this.changeState("initialized")};a.connect=function(){if(this.socket||this.state!=="initialized")return!1;var b=this.getURL(this.key,this.options);this.socket=this.createSocket(b);this.bindListeners();
Pusher.debug("Connecting",{transport:this.name,url:b});this.changeState("connecting");return!0};a.close=function(){return this.socket?(this.socket.close(),!0):!1};a.send=function(b){if(this.state==="open"){var a=this;setTimeout(function(){a.socket.send(b)},0);return!0}else return!1};a.onOpen=function(){this.changeState("open");this.socket.onopen=void 0};a.onError=function(b){this.emit("error",{type:"WebSocketError",error:b});this.log({error:b.name||"unknown"})};a.onClose=function(){this.changeState("closed");
this.socket=void 0};a.onMessage=function(b){this.emit("message",b)};a.bindListeners=function(){var b=this;this.socket.onopen=function(){b.onOpen()};this.socket.onerror=function(a){b.onError(a)};this.socket.onclose=function(){b.onClose()};this.socket.onmessage=function(a){b.onMessage(a)}};a.createSocket=function(){return null};a.getScheme=function(){return this.options.encrypted?"wss":"ws"};a.getBaseURL=function(){var b;b=this.options.encrypted?this.options.encryptedPort:this.options.unencryptedPort;
return this.getScheme()+"://"+this.options.host+":"+b};a.getPath=function(){return"/app/"+this.key};a.getQueryString=function(){return"?protocol=5&client=js&version="+Pusher.VERSION};a.getURL=function(){return this.getBaseURL()+this.getPath()+this.getQueryString()};a.changeState=function(b,a){this.state=b;this.emit(b,a);this.log({state:b,params:a})};a.log=function(b){this.timeline&&this.timeline.push(Pusher.Util.extend({transport:this.name+(this.options.encrypted?"s":"")},b))};Pusher.AbstractTransport=
c}).call(this);
(function(){function c(b,a){Pusher.AbstractTransport.call(this,b,a)}var a=c.prototype;Pusher.Util.extend(a,Pusher.AbstractTransport.prototype);a.name="flash";c.createConnection=function(b,a){return new c(b,a)};c.isSupported=function(){return navigator.mimeTypes["application/x-shockwave-flash"]!==void 0};a.initialize=function(){var b=this;this.changeState("initializing");if(window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR===void 0)window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=!0;window.WEB_SOCKET_SWF_LOCATION=
Pusher.Dependencies.getRoot()+"/WebSocketMain.swf";Pusher.Dependencies.load("flashfallback",function(){b.changeState("initialized")})};a.createSocket=function(b){return new WebSocket(b)};a.getQueryString=function(){return Pusher.AbstractTransport.prototype.getQueryString.call(this)+"&flash=true"};Pusher.FlashTransport=c}).call(this);
(function(){function c(b,a){Pusher.AbstractTransport.call(this,b,a)}var a=c.prototype;Pusher.Util.extend(a,Pusher.AbstractTransport.prototype);a.name="sockjs";c.createConnection=function(b,a){return new c(b,a)};c.isSupported=function(){return!0};a.initialize=function(){var b=this;this.changeState("initializing");Pusher.Dependencies.load("sockjs",function(){b.changeState("initialized")})};a.supportsPing=function(){return!0};a.createSocket=function(b){return new SockJS(b)};a.getScheme=function(){return this.options.encrypted?
"https":"http"};a.getPath=function(){return"/pusher"};a.getQueryString=function(){return""};a.onOpen=function(){this.socket.send(JSON.stringify({path:Pusher.AbstractTransport.prototype.getPath.call(this)}));this.changeState("open");this.socket.onopen=void 0};Pusher.SockJSTransport=c}).call(this);
(function(){function c(b,a){Pusher.AbstractTransport.call(this,b,a)}var a=c.prototype;Pusher.Util.extend(a,Pusher.AbstractTransport.prototype);a.name="ws";c.createConnection=function(b,a){return new c(b,a)};c.isSupported=function(){return window.WebSocket!==void 0||window.MozWebSocket!==void 0};a.createSocket=function(b){return new (window.WebSocket||window.MozWebSocket)(b)};a.getQueryString=function(){return Pusher.AbstractTransport.prototype.getQueryString.call(this)+"&flash=false"};Pusher.WSTransport=
c}).call(this);
(function(){function c(c,d){for(var h=a(d,{type:!0,children:!0}),j=[],k=0;k<d.children.length;k++)j.push(b.build(Pusher.Util.extend({},h,d.children[k])));return new c(j,h)}function a(b,a){var c={},d;for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]||(c[d]=b[d]));return c}var b={build:function(b){var a=h[b.type];if(!a)throw new Pusher.Errors.UnsupportedStrategy(b.type);return a(b)}},d={ws:Pusher.WSTransport,flash:Pusher.FlashTransport,sockjs:Pusher.SockJSTransport},h={transport:function(b){var c=d[b.transport];
if(!c)throw new Pusher.Errors.UnsupportedTransport(b.transport);b=a(b,{type:!0,transport:!0});return new Pusher.TransportStrategy(c,b)},delayed:function(c){var d=a(c,{type:!0,child:!0});return new Pusher.DelayedStrategy(b.build(Pusher.Util.extend({},d,c.child)),d)},sequential:function(b){return c(Pusher.SequentialStrategy,b)},first_supported:function(b){return c(Pusher.FirstSupportedStrategy,b)},first_connected:function(b){return c(Pusher.FirstConnectedStrategy,b)},best_connected_ever:function(b){return c(Pusher.BestConnectedEverStrategy,
b)}};Pusher.StrategyBuilder=b}).call(this);
(function(){function c(b){Pusher.EventsDispatcher.call(this);this.transport=b;this.bindListeners()}var a=c.prototype;Pusher.Util.extend(a,Pusher.EventsDispatcher.prototype);a.supportsPing=function(){return this.transport.supportsPing()};a.send=function(b){return this.transport.send(b)};a.send_event=function(b,a,c){b={event:b,data:a};if(c)b.channel=c;Pusher.debug("Event sent",b);return this.send(JSON.stringify(b))};a.close=function(){this.transport.close()};a.bindListeners=function(){var b=this,a=
function(e){e=b.parseMessage(e);if(e!==void 0)e.event==="pusher:connection_established"?(b.id=e.data.socket_id,b.transport.unbind("message",a),b.transport.bind("message",c),b.emit("connected",b.id)):e.event==="pusher:error"&&b.handleCloseCode(e.data.code,e.data.message)},c=function(a){a=b.parseMessage(a);if(a!==void 0){Pusher.debug("Event recd",a);switch(a.event){case "pusher:error":b.emit("error",{type:"PusherError",data:a.data});break;case "pusher:ping":b.emit("ping");break;case "pusher:pong":b.emit("pong")}b.emit("message",
a)}},e=function(a){b.emit("error",{type:"WebSocketError",error:a})},f=function(){b.transport.unbind("message",a);b.transport.unbind("message",c);b.transport.unbind("error",e);b.transport.unbind("closed",f);b.transport=null;b.emit("closed")};this.transport.bind("message",a);this.transport.bind("error",e);this.transport.bind("closed",f)};a.parseMessage=function(b){try{var a=JSON.parse(b.data);if(typeof a.data==="string")try{a.data=JSON.parse(a.data)}catch(c){if(!(c instanceof SyntaxError))throw c;}return a}catch(e){this.emit("error",
{type:"MessageParseError",error:e,data:b.data})}};a.handleCloseCode=function(b,a){this.emit("error",{type:"PusherError",data:{code:b,message:a}});b===4E3?this.emit("ssl_only"):b<4100?this.emit("refused"):b<4200?this.emit("backoff"):b<4300?this.emit("retry"):this.emit("refused");this.transport.close()};Pusher.ProtocolWrapper=c}).call(this);
(function(){function c(b,a){Pusher.EventsDispatcher.call(this);this.key=b;this.options=a||{};this.state="initialized";this.connection=null;this.strategy=a.getStrategy({key:b,timeline:a.getTimeline({},this)});var c=this;Pusher.Network.bind("online",function(){c.state==="unavailable"&&c.connect()});Pusher.Network.bind("offline",function(){c.shouldRetry()&&(c.disconnect(),c.updateState("unavailable"))})}var a=c.prototype;Pusher.Util.extend(a,Pusher.EventsDispatcher.prototype);a.connect=function(){if(!this.connection&&
this.state!=="connecting")if(this.strategy.isSupported())if(Pusher.Network.isOnline()===!1)this.updateState("unavailable");else{var b=this;this.updateState("connecting");var a=function(c,e){c?b.runner=b.strategy.connect(a):(b.runner.abort(),b.setConnection(b.wrapTransport(e)))};this.runner=this.strategy.connect(a);this.unavailableTimer=setTimeout(function(){if(b.unavailableTimer)b.updateState("unavailable"),b.unavailableTimer=null},this.options.unavailableTimeout)}else this.updateState("failed")};
a.send=function(b){return this.connection?this.connection.send(b):!1};a.send_event=function(b,a,c){return this.connection?this.connection.send_event(b,a,c):!1};a.disconnect=function(){this.runner&&this.runner.abort();this.clearRetryTimer();this.clearUnavailableTimer();this.stopActivityCheck();this.updateState("disconnected");if(this.connection)this.connection.close(),this.connection=null};a.retryIn=function(b){var a=this;this.retryTimer=setTimeout(function(){if(a.retryTimer!==null)a.retryTimer=null,
a.disconnect(),a.connect()},b||0)};a.clearRetryTimer=function(){if(this.retryTimer)clearTimeout(this.retryTimer),this.retryTimer=null};a.clearUnavailableTimer=function(){if(this.unavailableTimer)clearTimeout(this.unavailableTimer),this.unavailableTimer=null};a.resetActivityCheck=function(){this.stopActivityCheck();if(!this.connection.supportsPing()){var b=this;this.activityTimer=setTimeout(function(){b.send_event("pusher:ping",{});b.activityTimer=setTimeout(function(){b.connection.close()},b.options.pongTimeout)},
this.options.activityTimeout)}};a.stopActivityCheck=function(){if(this.activityTimer)clearTimeout(this.activityTimer),this.activityTimer=null};a.setConnection=function(b){this.connection=b;var a=this,c=function(b){a.clearUnavailableTimer();a.socket_id=b;a.updateState("connected");a.resetActivityCheck()},e=function(b){a.resetActivityCheck();a.emit("message",b)},f=function(){a.send_event("pusher:pong",{})},g=function(b){a.emit("error",{type:"WebSocketError",error:b})},j=function(){b.unbind("connected",
c);b.unbind("message",e);b.unbind("ping",f);b.unbind("error",g);b.unbind("closed",j);a.connection=null;a.shouldRetry()&&a.retryIn(0)};b.bind("connected",c);b.bind("message",e);b.bind("ping",f);b.bind("error",g);b.bind("closed",j);b.bind("ssl_only",function(){a.strategy=a.options.getStrategy({key:a.key,encrypted:!0,timeline:a.options.getTimeline({encrypted:!0},a)});a.retryIn(0)});b.bind("refused",function(){a.disconnect()});b.bind("backoff",function(){a.retryIn(1E3)});b.bind("retry",function(){a.retryIn(0)});
this.resetActivityCheck()};a.updateState=function(a,c){var h=this.state;this.state=a;h!==a&&(Pusher.debug("State changed",h+" -> "+a),this.emit("state_change",{previous:h,current:a}),this.emit(a,c))};a.shouldRetry=function(){return this.state==="connecting"||this.state==="connected"};a.wrapTransport=function(a){return new Pusher.ProtocolWrapper(a)};Pusher.ConnectionManager=c}).call(this);
(function(){function c(a,b,c){if(b[a]!==void 0)b[a](c)}function a(a,c,e){b.EventsDispatcher.call(this);this.state=void 0;this.errors=[];this.stateActions=e;this.transitions=c;this.transition(a)}var b=this.Pusher;a.prototype.transition=function(a,h){var e=this.state,f=this.stateActions;if(e&&b.Util.arrayIndexOf(this.transitions[e],a)==-1)throw this.emit("invalid_transition_attempt",{oldState:e,newState:a}),Error("Invalid transition ["+e+" to "+a+"]");c(e+"Exit",f,h);c(e+"To"+(a.substr(0,1).toUpperCase()+
a.substr(1)),f,h);c(a+"Pre",f,h);this.state=a;this.emit("state_change",{oldState:e,newState:a});c(a+"Post",f,h)};a.prototype.is=function(a){return this.state===a};a.prototype.isNot=function(a){return this.state!==a};b.Util.extend(a.prototype,b.EventsDispatcher.prototype);this.Pusher.Machine=a}).call(this);
(function(){function c(){Pusher.EventsDispatcher.call(this);var a=this;window.addEventListener!==void 0&&(window.addEventListener("online",function(){a.emit("online")},!1),window.addEventListener("offline",function(){a.emit("offline")},!1))}Pusher.Util.extend(c.prototype,Pusher.EventsDispatcher.prototype);c.prototype.isOnline=function(){return window.navigator.onLine===void 0?!0:window.navigator.onLine};Pusher.NetInfo=c;Pusher.Network=new c}).call(this);
(function(){Pusher.Channels=function(){this.channels={}};Pusher.Channels.prototype={add:function(a,b){var c=this.find(a);c||(c=Pusher.Channel.factory(a,b),this.channels[a]=c);return c},find:function(a){return this.channels[a]},remove:function(a){delete this.channels[a]},disconnect:function(){for(var a in this.channels)this.channels[a].disconnect()}};Pusher.Channel=function(a,b){var c=this;Pusher.EventsDispatcher.call(this,function(b){Pusher.debug("No callbacks on "+a+" for "+b)});this.pusher=b;this.name=
a;this.subscribed=!1;this.bind("pusher_internal:subscription_succeeded",function(a){c.onSubscriptionSucceeded(a)})};Pusher.Channel.prototype={init:function(){},disconnect:function(){this.subscribed=!1;this.emit("pusher_internal:disconnected")},onSubscriptionSucceeded:function(){this.subscribed=!0;this.emit("pusher:subscription_succeeded")},authorize:function(a,b,c){return c(!1,{})},trigger:function(a,b){return this.pusher.send_event(a,b,this.name)}};Pusher.Util.extend(Pusher.Channel.prototype,Pusher.EventsDispatcher.prototype);
Pusher.Channel.PrivateChannel={authorize:function(a,b,c){var h=this;return(new Pusher.Channel.Authorizer(this,Pusher.channel_auth_transport,b)).authorize(a,function(a,b){a||h.emit("pusher_internal:authorized",b);c(a,b)})}};Pusher.Channel.PresenceChannel={init:function(){this.members=new c(this)},onSubscriptionSucceeded:function(){this.subscribed=!0}};var c=function(a){var b=this,c=function(){this._members_map={};this.count=0;this.me=null};c.call(this);a.bind("pusher_internal:authorized",function(c){var d=
JSON.parse(c.channel_data);a.bind("pusher_internal:subscription_succeeded",function(c){b._members_map=c.presence.hash;b.count=c.presence.count;b.me=b.get(d.user_id);a.emit("pusher:subscription_succeeded",b)})});a.bind("pusher_internal:member_added",function(c){b.get(c.user_id)===null&&b.count++;b._members_map[c.user_id]=c.user_info;a.emit("pusher:member_added",b.get(c.user_id))});a.bind("pusher_internal:member_removed",function(c){var d=b.get(c.user_id);d&&(delete b._members_map[c.user_id],b.count--,
a.emit("pusher:member_removed",d))});a.bind("pusher_internal:disconnected",function(){c.call(b)})};c.prototype={each:function(a){for(var b in this._members_map)a(this.get(b))},get:function(a){return this._members_map.hasOwnProperty(a)?{id:a,info:this._members_map[a]}:null}};Pusher.Channel.factory=function(a,b){var c=new Pusher.Channel(a,b);a.indexOf("private-")===0?Pusher.Util.extend(c,Pusher.Channel.PrivateChannel):a.indexOf("presence-")===0&&(Pusher.Util.extend(c,Pusher.Channel.PrivateChannel),
Pusher.Util.extend(c,Pusher.Channel.PresenceChannel));c.init();return c}}).call(this);
(function(){Pusher.Channel.Authorizer=function(c,a,b){this.channel=c;this.type=a;this.authOptions=(b||{}).auth||{}};Pusher.Channel.Authorizer.prototype={composeQuery:function(c){var c="&socket_id="+encodeURIComponent(c)+"&channel_name="+encodeURIComponent(this.channel.name),a;for(a in this.authOptions.params)c+="&"+encodeURIComponent(a)+"="+encodeURIComponent(this.authOptions.params[a]);return c},authorize:function(c,a){return Pusher.authorizers[this.type].call(this,c,a)}};Pusher.auth_callbacks={};
Pusher.authorizers={ajax:function(c,a){var b;b=Pusher.XHR?new Pusher.XHR:window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.open("POST",Pusher.channel_auth_endpoint,!0);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var d in this.authOptions.headers)b.setRequestHeader(d,this.authOptions.headers[d]);b.onreadystatechange=function(){if(b.readyState==4)if(b.status==200){var c,d=!1;try{c=JSON.parse(b.responseText),d=!0}catch(f){a(!0,"JSON returned from webapp was invalid, yet status code was 200. Data was: "+
b.responseText)}d&&a(!1,c)}else Pusher.warn("Couldn't get auth info from your webapp",b.status),a(!0,b.status)};b.send(this.composeQuery(c));return b},jsonp:function(c,a){this.authOptions.headers!==void 0&&Pusher.warn("Warn","To send headers with the auth request, you must use AJAX, rather than JSONP.");var b=document.createElement("script");Pusher.auth_callbacks[this.channel.name]=function(b){a(!1,b)};b.src=Pusher.channel_auth_endpoint+"?callback="+encodeURIComponent("Pusher.auth_callbacks['"+this.channel.name+
"']")+this.composeQuery(c);var d=document.getElementsByTagName("head")[0]||document.documentElement;d.insertBefore(b,d.firstChild)}}}).call(this);